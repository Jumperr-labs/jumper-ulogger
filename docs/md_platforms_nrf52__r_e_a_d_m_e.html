<!-- HTML header for doxygen 1.8.8-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <!-- For Mobile Devices -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
        <meta name="generator" content="Doxygen 1.8.13"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
        <title>Jumper uLogger: nRF52 Readme</title>
        <!--<link href="tabs.css" rel="stylesheet" type="text/css"/>-->
        <script type="text/javascript" src="dynsections.js"></script>
        <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
        <link href="doxygen.css" rel="stylesheet" type="text/css" />
        <link href="customdoxygen.css" rel="stylesheet" type="text/css"/>
        <link href='https://fonts.googleapis.com/css?family=Roboto+Slab' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="doxy-boot.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-default" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <a class="navbar-brand">Jumper uLogger </a>
                </div>
            </div>
        </nav>
        <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
            <div class="content" id="content">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12 panel " style="padding-bottom: 15px;">
                            <div style="margin-bottom: 15px;">
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">nRF52 Readme </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Follow these instructions to integrate Jumper Insights to an nRF52 project. Note how small the footprint is? We also made sure the bandwidth and energy requirements are minimal.</p>
<p>The nRF52 is using GATT protocol to send events to a Linux gateway over BLE. The gateway should have the BLE Logger running. Check it <a href="https://github.com/Jumperr-labs/jumper-ble-logger">this repo</a></p>
<h2>Getting Started</h2>
<p>Check out this <a href="https://github.com/Jumperr-labs/jumper-ulogger/tree/master/samples/nrf52-ble-sample-project">tutorial</a> to get started with a sample project for the nRF52.</p>
<p>You can also use this <a href="https://github.com/Jumperr-labs/jumper-ulogger/tree/master/samples/nrf52-ble-template">template project</a> to embed jumper's µlogger in your own code.</p>
<h2>How It Works</h2>
<p>When a logging event occures it is being saved to a buffer. Using an RTC handle, every given time interval the logged events will be sent over BLE to the gateway.</p>
<h2>Adding the µlogger to Your nRF52 Project</h2>
<h3>Relevant code files</h3>
<p>Add the following files and include paths to your code: </p><div class="fragment"><div class="line">Repository Root</div><div class="line">├── README.md</div><div class="line">├── platforms</div><div class="line">│   └── nrf52</div><div class="line">│       ├── README.md</div><div class="line">│       ├── gatt_handler.c</div><div class="line">│       ├── gatt_handler.h</div><div class="line">│       ├── trace_nrf52.c</div><div class="line">│       ├── trace_nrf52.h</div><div class="line">│       ├── ulogger_nrf52.c</div><div class="line">│       └── ulogger_nrf52.h</div><div class="line">└── ulogger</div><div class="line">    ├── handlers</div><div class="line">    │   ├── network_log_handler.c</div><div class="line">    │   └── network_log_handler.h</div><div class="line">    ├── ubuffer.c</div><div class="line">    ├── ubuffer.h</div><div class="line">    ├── ulogger.c</div><div class="line">    └── ulogger.h</div></div><!-- fragment --><h3>Changes to main.c</h3>
<ul>
<li>Add the following includes to your set of includes: <div class="fragment"><div class="line">#include &quot;ulogger.h&quot;</div><div class="line">#include &quot;ulogger_nrf52.h&quot;</div><div class="line">#include &quot;trace_nrf52.h&quot;</div></div><!-- fragment --></li>
<li>Next up, on <code>ble_stack_init(void)</code>, increase the UUID count by 1 as we’re adding a vendor specific GATT service. In Nordic’s example it was set to 0, so we’re increasing to 1. <div class="fragment"><div class="line">ble_cfg.common_cfg.vs_uuid_cfg.vs_uuid_count = 1;</div></div><!-- fragment --></li>
<li>We need to receive BLE events from the SoftDevice, to do so add the following line in the <code>ble_evt_dispatch</code>: <div class="fragment"><div class="line">ulogger_handle_ble_event(p_ble_evt);</div></div><!-- fragment --></li>
</ul>
<h3>Linking</h3>
<h4>ARMGCC</h4>
<p>Moving on to the *.ld file, in our case <code>ble_app_template_gcc_nrf52.ld</code>:</p>
<p>From the <code>Memory.RAM</code> section, push the origin 0x10 bytes forward and reduce the length by 0x10 bytes. Based on the original example, this means changing this line: </p><div class="fragment"><div class="line">RAM (rwx) :  ORIGIN = 0x20001fc0, LENGTH = 0xe040</div></div><!-- fragment --><p> To this: </p><div class="fragment"><div class="line">RAM (rwx) :  ORIGIN = 0x20001fd0, LENGTH = 0xe030</div></div><!-- fragment --> <h4>IAR</h4>
<p>In your *.icf file (here we used <code>ble_app_template_iar_nRF5x.icf</code>, change RAM start by 0x10 bytes, from: </p><div class="fragment"><div class="line">define symbol __ICFEDIT_region_RAM_start__   = 0x20001fc0;</div></div><!-- fragment --><p> To this: </p><div class="fragment"><div class="line">define symbol __ICFEDIT_region_RAM_start__   = 0x20001fd0;</div></div><!-- fragment --><h3>Initialization</h3>
<p>Add a definition for the <a class="el" href="structu_logger.html" title="The data structure for storing the ulogger context. ">uLogger</a> struct, we added following code right after the <code>assert_nrf_callback</code>:</p>
<div class="fragment"><div class="line">uLogger ulogger;</div></div><!-- fragment --><p>Finally on the <code>main(void)</code> function, add the following line when initializing services </p><div class="fragment"><div class="line">ulogger_init_nrf52(&amp;ulogger);</div></div><!-- fragment --><p> Note - this has to happen after the SoftDevice is configured and BLE is initialized. </p><h3>Tracing</h3>
<p>To trace advertising events add the following line to the beginning of the <code>on_adv_evt</code> function </p><div class="fragment"><div class="line">ulogger_trace_nrf_ble_adv_event(ble_adv_evt);</div></div><!-- fragment --> <h3>Configuration</h3>
<p>Create a copy of <code><a class="el" href="logging__config_8h_source.html">logging_config.h</a></code> and add it to your project. Currently there are two configuration options.</p>
<p>You can edit either of these options, depending on the number of log events you intend to add per second or your power budget.</p>
<p>The configuration option are:</p><ul>
<li><code>GATT_BUFFER_SIZE</code> - Buffer size in bytes, currently defaults to 200.</li>
<li><code>LOG_SEND_PERIOD_MS</code> - Period between sending the logging buffer to the gateway, currently defaults to 5000 ms. </li>
</ul>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.8-->
<!-- start footer part -->
</div>
</div>
</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>
Generated on Mon May 15 2017 11:47:41 for Jumper uLogger by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
