# CC3200 Platform Readme

In the CC3200 platform, since we're using wifi, we have to directly interact with jumper's API, this client implements an HTTP client that interacts securely with our service.

## Getting started

You can check out [this](TBD) tutorial to quickly get started.

## How it works

All logged events are saved into the buffer as they are generated by your code, every pre-defined interval the buffer is flushed and all events are formatted and sent to the server.

# Adding the CC3200 µlogger to your project

## Relevant files
Add all the files in the _ulogger_ directory, _ulogger/handlers_ and _platforms/cc3200_.
```
Repository Root
├── README.md
├── platforms
│   ├── cc3200
│   │   ├── README.md
│   │   ├── events_api_handler.c
│   │   ├── events_api_handler.h
│   │   ├── json_encoding_helper.h
│   │   ├── json_formatter.c
│   │   ├── json_formatter.h
│   │   ├── logging_config.h
│   │   ├── ulogger_cc3200.c
│   │   └── ulogger_cc3200.h
│   └── nrf52
├── porting.md
├── samples
│   ├── cc3200-sample
│   └─ nrf52-ble
└── ulogger
    ├── CMakeLists.txt
    ├── handlers
    │   ├── network_log_handler.c
    │   └── network_log_handler.h
    ├── ubuffer.c
    ├── ubuffer.h
    ├── ulogger.c
    ├── ulogger.h
    └── ulogger_events.h
```
## Changes to main.c

* Define a logger struct - `uLogger logger`
* We use the status unsigned long that TI use in their samples to determine the connection state - `g_ulStatus`, make sure that you have it and keep it synced with the state of the device.
You can also override this method, more info in the documentation.
* Initialize the ulogger with the logger struct `ulogger_init_cc3200(&logger)`

## Configuration

In `logging_config.h` you have the following configurations avilable:

```
#define JUMPER_API_VERSION  "3.0"
#define JUMPER_PROJECT_ID  "000000000000000000000000"
#define JUMPER_WRITE_KEY "000000000000000000000000"

#define API_HANDLER_LOG_SEND_PERIOD 5000
#define API_HANDLER_BUFFER_SIZE 300
#define API_HANDLE_JSON_ENCODER_BUFFER_SIZE 200
#define EVENTS_API_HANDLER_STACK_SIZE 1000
```

* You must replace `JUMPER_PROJECT_ID` and `JUMPER_WRITE_KEY` with the keys you get from the jumper control panel.
* The definitions `API_HANDLER_LOG_SEND_PERIOD` and `API_HANDLER_BUFFER_SIZE` control the buffer size and flush interval
of the buffer that accumulates logging events, change those if you want to increase the interval or buffer size depending on the number of log events you intend to add per second or your power budget.
* `API_HANDLE_JSON_ENCODER_BUFFER_SIZE` defines the buffer size of the encoder that encodes events into JSON format, it must be large enough to fit the largest event, in JSON format.

## JSON formatter

In the CC3200 platform directory you will find `json_formatter.c`, in the method `json_formatter_format` you must implement a case for each of your user defined events. We implemented several examples with helper
methods to easily generate a json object from your event data.

For example, in this method we're packing a wlan event (which is generated when the device is connected to a wifi network), and pack its fields consisting of an integer and a null terminated string:
```
case WLAN_EVENT:
{
    wlan_event_t * event_metadata = (wlan_event_t *) additional_data;
    PACK_EVENT_TYPE(buf, WLAN_EVENT);
    PACK_NAME_AND_INT(buf, event_metadata, is_connected);
    PACK_NAME_AND_STRING(buf, event_metadata, bssid);
}
```
For more information about the helper methods and the formatter check out the documentation.

## Helper Library
1. You'll also be using a modified version of the keen.io cc3200 client as a helper library.
2. Check out the repo [here](https://github.com/Jumperr-labs/keen-cc3200) and compile it as a library.
3. Define the library as a dependency in Code Composer Studio.